{% extends "base.html" %}

{% block content %}
<h2 class="mb-4">Book Catalog</h2>

{% if request.user.librarian %}
<a href="{% url 'create_book' %}" class="btn btn-primary mb-4">–î–æ–±–∞–≤–∏—Ç—å –∫–Ω–∏–≥—É</a>
{% endif %}

<table class="table table-striped table-bordered">
    <thead class="table-light">
    <tr>
        <th>Title</th>
        <th>Author</th>
        <th>Genre</th>
        <th>Action</th>
    </tr>
    </thead>
    <tbody>
    {% for book in books %}
    <tr>
        <td>
            {{ book.title }}
            <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('{{ book.title }}')">
                üì§
            </button>
        </td>
        <td>{{ book.author }}</td>
        <td>{{ book.genre }}</td>
        <td>
            {% if book.is_borrowed %}
            {% if book.borrowed_by == request.user %}
            <form method="post" action="{% url 'borrow_book' book.id %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-danger">
                    –í–µ—Ä–Ω—É—Ç—å
                </button>
            </form>
            {% else %}
            <button class="btn btn-secondary" disabled>
                –í–∑—è—Ç–∞ —á–∏—Ç–∞—Ç–µ–ª–µ–º
            </button>
            {% endif %}
            {% else %}
            <form method="post" action="{% url 'borrow_book' book.id %}" class="d-inline">
                {% csrf_token %}
                <button type="submit" class="btn btn-success">
                    –í–∑—è—Ç—å
                </button>
            </form>
            {% endif %}
        </td>
    </tr>
    {% endfor %}
    </tbody>
</table>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        alert('–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + text);
    }).catch(function(error) {
        console.error('–û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞: ', error);
    });
}
</script>
{% endblock %}
